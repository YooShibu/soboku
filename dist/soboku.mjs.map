{"version":3,"file":"soboku.mjs","sources":["../src/util.ts","../src/reporter/reporter.ts","../src/state/state.ts","../src/reporter/gate.ts","../src/state/sarray.ts","../src/calc/calc.ts","../src/calc/combine.ts","../src/calc/editer.ts","../src/calc/trigger.ts","../src/calc/publisher.ts"],"sourcesContent":["import { IStateHolder } from \"../index.d\";\r\nimport { Depends } from \"./calc/calc\";\r\nimport { ReporterClass, SobokuListenerClass } from \"./reporter/reporter\";\r\n\r\n\r\nexport function optimizeCB<T>(func: (...args: any[]) => T): (args: any[]) => T {\r\n    switch (func.length) {\r\n        case 1:\r\n            return (args: any[]) => func(args[0])\r\n        case 2:\r\n            return (args: any[]) => func(args[0], args[1]);\r\n        case 3:\r\n            return (args: any[]) => func(args[0], args[1], args[2]);\r\n        case 4:\r\n            return (args: any[]) => func(args[0], args[1], args[2], args[3]);\r\n        default:\r\n            return (args: any[]) => func.apply(undefined, args);\r\n    }\r\n}\r\n\r\nexport function has(obj: object, key: string): boolean {\r\n    return Object.prototype.hasOwnProperty.call(obj, key);\r\n}\r\n\r\nexport function unique<T>(arr: T[]): T[] {\r\n    const result: T[] = [];\r\n    for (let i = 0; arr.length > i; ++i) {\r\n        const val = arr[i];\r\n        if (indexOf(result, val) === -1) {\r\n            result.push(val);\r\n        }\r\n    }\r\n    return result;\r\n}\r\n\r\nexport function identity<T>(x: T): T {\r\n    return x;\r\n}\r\n\r\nexport function indexOf<T>(arr: T[], val: T): number {\r\n    for (let i = 0; arr.length > i; ++i) {\r\n        if (arr[i] === val) {\r\n            return i;\r\n        }\r\n    }\r\n    return -1;\r\n}\r\n\r\nexport function spliceOne<T>(arr: T[], index: number): void {\r\n    if (0 > index) {\r\n        return;\r\n    }\r\n    for (let i = index, j = index + 1; arr.length > j; ++i, ++j) {\r\n        arr[i] = arr[j];\r\n    }\r\n    arr.pop();\r\n}\r\n\r\nexport function map<T, U>(arr: T[], iteratee: (val: T) => U): U[] {\r\n    const result: U[] = [];\r\n    for (let i = 0; arr.length > i; ++i) {\r\n        result.push(iteratee(arr[i]));\r\n    }\r\n    return result;\r\n}\r\n\r\nexport function mapObj<T extends { [key: string]: any }, U extends { [key: string]: any }>(obj: T, iteratee: <K1 extends keyof T, K2 extends keyof U>(val: T[K1]) => U[K2]): U {\r\n    const result: { [key: string]: any } = {};\r\n    for (let key in obj) {\r\n        result[key] = iteratee(obj[key]);\r\n    }\r\n    return result as U;\r\n}\r\n\r\nexport function isSobokuReporter(x: any): x is ReporterClass<any> {\r\n    return typeof x === \"object\" && x instanceof ReporterClass;\r\n}\r\n\r\nexport function isStateHolder(x: any): x is IStateHolder<any> {\r\n    return typeof x === \"object\"  && typeof x.s === \"function\";\r\n}\r\n\r\nexport function isDepends(x: any): x is Depends {\r\n    return isSobokuReporter(x) && has(x, \"depends\");\r\n}\r\n","import { Listener, IReporter, IListener, IProgressable, IUnsubscriber, Reporter } from \"../../index.d\";\r\nimport * as u from \"../util\";\r\n\r\n\r\nclass UnListenerClass<T> implements IUnsubscriber {\r\n    private listeners: SobokuListenerClass<any>[] | null;\r\n    private listener: SobokuListenerClass<T> | null;\r\n    \r\n    constructor(listeners: SobokuListenerClass<any>[], listener: SobokuListenerClass<T>) {\r\n        this.listeners = listeners;\r\n        this.listener = listener;\r\n    }\r\n\r\n    public unsubscribe() {\r\n        const listeners = this.listeners;\r\n        if (listeners === null) {\r\n            return;\r\n        }\r\n        const i = u.indexOf(listeners, this.listener);\r\n        u.spliceOne(listeners, i);\r\n        this.listeners = null;\r\n        this.listener = null;\r\n    }\r\n    \r\n}\r\n\r\nexport class SobokuListenerClass<T> implements IListener<T> {\r\n\r\n    constructor(private readonly listener: Listener<T>, private readonly thisArg?: any) {\r\n        if (typeof listener !== \"function\") {\r\n            throw new TypeError(\"'listener' must be a function\");\r\n        }\r\n    }\r\n\r\n    public read(news: T) {\r\n        this.listener.call(this.thisArg, news);\r\n    }\r\n    \r\n}\r\n\r\nexport class ReporterClass<T> implements IReporter<T>, IProgressable<T> {\r\n    private readonly listeners: SobokuListenerClass<T>[] = [];\r\n\r\n    public next(val: T): T {\r\n        const listeners = this.listeners;\r\n        for (let i = 0; listeners.length > i; ++i)\r\n            listeners[i].read(val);\r\n        return val;\r\n    }\r\n\r\n    public report(listener: Listener<T> | SobokuListenerClass<T>): IUnsubscriber {\r\n        const _listener = listener instanceof SobokuListenerClass\r\n            ? listener\r\n            : new SobokuListenerClass(listener);\r\n        this.listeners.push(_listener);\r\n        return new UnListenerClass(this.listeners, _listener);\r\n    }\r\n\r\n    public listenerCount(): number {\r\n        return this.listeners.length;\r\n    }\r\n\r\n}\r\n\r\nexport function reporter<T>(): Reporter<T> {\r\n    return new ReporterClass();\r\n}\r\n\r\nexport function listener<T>(listener: Listener<T>, thisArg?: any): SobokuListenerClass<T> {\r\n    return new SobokuListenerClass(listener, thisArg);\r\n}\r\n","import { Atom, IProgressable, State, IStateHolder } from \"../../index.d\";\r\nimport { ReporterClass, SobokuListenerClass } from \"../reporter/reporter\";\r\nimport * as u from \"../util\";\r\n\r\n\r\nclass StateClass<T> extends ReporterClass<T> implements IProgressable<T> {\r\n\r\n    constructor(private state: T) {\r\n        super();\r\n    }\r\n\r\n    public next(val: T): T {\r\n        this.state = val;\r\n        return super.next(val);\r\n    }\r\n\r\n    public s() {\r\n        return this.state;\r\n    }\r\n    \r\n}\r\n\r\nclass StateHolderClass<T> implements IStateHolder<T> {\r\n\r\n    constructor(private readonly state: T) {}\r\n\r\n    public s() {\r\n        return this.state;\r\n    }\r\n    \r\n}\r\n\r\nexport function state<T>(initial: T): State<T> {\r\n    return new StateClass(initial);\r\n}\r\n\r\nexport function convAtomToStateHolder<T>(atom: Atom<T>): IStateHolder<T> {\r\n    if (u.isStateHolder(atom)) {\r\n        return atom;\r\n    }\r\n    return new StateHolderClass(atom);\r\n}\r\n","import { IReporter, IStateHolder } from \"../../index.d\";\r\nimport { ReporterClass, SobokuListenerClass } from \"./reporter\";\r\n\r\n\r\nclass GateClass<T> extends ReporterClass<T> {\r\n\r\n    constructor(private readonly gatekeeper: IStateHolder<boolean>, reporter: IReporter<T>) {\r\n        super();\r\n        reporter.report(new SobokuListenerClass(this.listener, this));\r\n    }\r\n\r\n    private listener(val: T): void {\r\n        if (this.gatekeeper.s()) {\r\n            this.next(val);\r\n        }\r\n    }\r\n    \r\n}\r\n\r\nexport function gate<T>(gatekeeper: IStateHolder<boolean>, reporter: IReporter<T>): IReporter<T> {\r\n    return new GateClass(gatekeeper, reporter);\r\n}","import { ISArray } from \"../../index.d\";\r\nimport { ReporterClass } from \"../reporter/reporter\";\r\n\r\n\r\nclass SobokuArrayClass<T> extends ReporterClass<T[]> implements ISArray<T> {\r\n    private readonly array: T[] = [];\r\n\r\n    constructor(array?: T[]) {\r\n        super();\r\n        this.array = array || [];\r\n    }\r\n        \r\n    public s(): T[] {\r\n        return this.array;\r\n    }\r\n\r\n    public pop(): T | undefined {\r\n        const result = this.array.pop();\r\n        this.next(this.array);\r\n        return result;\r\n    }\r\n\r\n    public push(): number {\r\n        const i = Array.prototype.push.apply(this.array, arguments);\r\n        this.next(this.array);\r\n        return i;\r\n    }\r\n\r\n    public reverse(): T[] {\r\n        this.array.reverse();\r\n        this.next(this.array);\r\n        return this.array;\r\n    }\r\n\r\n    public shift(): T | undefined {\r\n        const result = this.array.shift();\r\n        this.next(this.array);\r\n        return result;\r\n    }\r\n\r\n    public sort(compareFn?: (a: T, b: T) => number): T[] {\r\n        this.array.sort(compareFn);\r\n        this.next(this.array);\r\n        return this.array;\r\n    }\r\n    \r\n    public splice(): T[] {\r\n        Array.prototype.splice.apply(this.array, arguments);\r\n        this.next(this.array);\r\n        return this.array;\r\n    }\r\n\r\n    public unshift(): number {\r\n        const result = Array.prototype.unshift.apply(this.array, arguments);\r\n        this.next(this.array);\r\n        return result;\r\n    }\r\n\r\n}\r\n\r\nexport function sarray<T>(array?: T[]): ISArray<T> {\r\n    return new SobokuArrayClass<T>(array);\r\n}","import { Atom, IStateHolder } from \"../../index.d\";\r\nimport { convAtomToStateHolder } from \"../state/state\";\r\nimport { ReporterClass, SobokuListenerClass } from \"../reporter/reporter\";\r\nimport * as u from \"../util\";\r\n\r\nexport type Depends = { readonly depends: ReporterClass<any>[] };\r\n\r\nexport function getDeps(atoms: Atom<any>[]): ReporterClass<any>[] {\r\n    let result: ReporterClass<any>[] = [];\r\n    for (let i = 0; atoms.length > i; ++i) {\r\n        const atom = atoms[i];\r\n        if(u.isDepends(atom)) {\r\n            result = result.concat(atom.depends);\r\n        } else if (u.isSobokuReporter(atom)) {\r\n            result.push(atom);\r\n        }\r\n    }\r\n    return u.unique(result);\r\n}\r\n\r\nexport function getState<T>(sh: IStateHolder<T>): T {\r\n    return sh.s();\r\n}\r\n\r\nexport abstract class CalcClass<T> extends ReporterClass<T> implements IStateHolder<T>, Depends {\r\n    public readonly depends: ReporterClass<any>[] = [];\r\n\r\n    public abstract s(): T;\r\n\r\n    protected addDepends(atoms: Atom<any>[], listener: SobokuListenerClass<any>) {\r\n        const depends = getDeps(atoms);\r\n        for (let i = 0; depends.length > i; ++i) {\r\n            depends[i].report(listener);\r\n        }\r\n        this.depends.push.apply(this.depends, depends);\r\n    }\r\n\r\n    protected listener(val: T): void {\r\n        this.next(this.s());\r\n    };\r\n    \r\n}\r\n","import { Atom, Calc, IStateHolder } from \"../../index.d\";\r\nimport { convAtomToStateHolder } from \"../state/state\";\r\nimport { SobokuListenerClass } from \"../reporter/reporter\";\r\nimport * as u from \"../util\";\r\nimport { CalcClass, getState } from \"./calc\";\r\n\r\n\r\nclass CombineClass<T> extends CalcClass<T> {\r\n    private readonly shObj: { [K in keyof T]: IStateHolder<T[K]> };\r\n\r\n    constructor(atomObj: { [K in keyof T]: Atom<T[K]>}) {\r\n        super();\r\n        const atoms: Atom<any>[] = [];\r\n        for (let key in atomObj) {\r\n            atoms.push(atomObj[key]);\r\n        }\r\n        super.addDepends(atoms, new SobokuListenerClass(this.listener, this));\r\n        this.shObj = u.mapObj(atomObj, convAtomToStateHolder);\r\n    }\r\n\r\n    public s() {\r\n        return u.mapObj<{ [K in keyof T]: IStateHolder<T[K]> }, T>(this.shObj, getState);\r\n    }\r\n    \r\n}\r\n\r\nexport function combine<T>(atomObj: { [K in keyof T]: Atom<T[K]>}): Calc<T> {\r\n    return new CombineClass(atomObj);\r\n}\r\n","import { Atom, Calc, IStateHolder } from \"../../index.d\";\r\nimport { convAtomToStateHolder } from \"../state/state\";\r\nimport { SobokuListenerClass } from \"../reporter/reporter\";\r\nimport * as u from \"../util\";\r\nimport { CalcClass, getState } from \"./calc\";\r\n\r\n\r\nexport class EditerClass<T> extends CalcClass<T> {\r\n    private readonly func: (args: any[]) => T;\r\n    private readonly states: IStateHolder<any>[];\r\n\r\n    constructor(func: (...args: any[]) => T, atoms: Atom<any>[]) {\r\n        super();\r\n        this.func = u.optimizeCB(func);\r\n        this.states = u.map(atoms, convAtomToStateHolder);\r\n        super.addDepends(atoms, new SobokuListenerClass(this.listener, this));\r\n    }\r\n\r\n    public s(): T {\r\n        const args = u.map(this.states, getState);\r\n        return this.func(args);\r\n    }\r\n\r\n}\r\n\r\nexport function editer<T>(func: (...args: any[]) => T, atoms: Atom<any>[]): Calc<T> {\r\n    return new EditerClass(func, atoms);\r\n}","import { Atom, Calc, IStateHolder } from \"../../index.d\";\r\nimport { SobokuListenerClass } from \"../reporter/reporter\";\r\nimport * as u from \"../util\";\r\nimport { CalcClass } from \"./calc\";\r\n\r\n\r\nclass TriggerClass extends CalcClass<boolean> {\r\n\r\n    constructor(private readonly condition: Calc<boolean>) {\r\n        super();\r\n        const listener = new SobokuListenerClass(this.onConditionChanged, this);\r\n        super.addDepends([condition], listener);\r\n    }\r\n\r\n    private onConditionChanged() {\r\n        const s = this.s();\r\n        if (s)\r\n            this.next(s);\r\n    }\r\n\r\n    public s() {\r\n        return this.condition.s();\r\n    }\r\n\r\n}\r\n\r\nclass NTriggerClass extends TriggerClass {\r\n\r\n    public s() {\r\n        return !super.s()\r\n    }\r\n    \r\n}\r\n\r\nexport function trigger(condition: Calc<boolean>): Calc<boolean> {\r\n    return new TriggerClass(condition);\r\n}\r\n\r\nexport function ntrigger(condition: Calc<boolean>): Calc<boolean> {\r\n    return new NTriggerClass(condition);\r\n}\r\n","import { Calc, IStateHolder } from \"../../index.d\";\r\nimport { ReporterClass, SobokuListenerClass } from \"../reporter/reporter\";\r\nimport * as u from \"../util\";\r\nimport { CalcClass } from \"./calc\";\r\n\r\n\r\nclass PublisherClass<T> extends CalcClass<T> {\r\n    private prevPermition: boolean;\r\n\r\n    constructor(private readonly permition: Calc<boolean>, private readonly reporter: Calc<T>) {\r\n        super();\r\n        this.prevPermition = permition.s();\r\n        super.addDepends([permition], new SobokuListenerClass(this.permitionChanged, this));\r\n        super.addDepends([reporter], new SobokuListenerClass(this.publish, this));\r\n    }\r\n\r\n    public s(): T {\r\n        return this.reporter.s();\r\n    }\r\n    \r\n    private publish() {\r\n        if (this.permition.s()) {\r\n            this.next(this.reporter.s());\r\n        }\r\n    }\r\n\r\n    private permitionChanged() {\r\n        const permition = this.permition.s();\r\n        if (permition && this.prevPermition === false) {\r\n            this.next(this.reporter.s());\r\n        }\r\n        this.prevPermition = permition;\r\n    }\r\n    \r\n}\r\n\r\nexport function publisher<T>(permition: Calc<boolean>, reporter: Calc<T>): Calc<T> {\r\n    return new PublisherClass(permition, reporter);\r\n}\r\n"],"names":["u.indexOf","u.spliceOne","u.isStateHolder","reporter","u.isDepends","u.isSobokuReporter","u.unique","listener","u.mapObj","u.optimizeCB","u.map"],"mappings":"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"}